# !/usr/bin/env Rscript
# ==============================================================================
# Test normalization methods for drosophila transcriptomic network analysis
#
# Script by Gabriel Thornes
#
# Last Updated: 08/10/2025
#
# This script::
#   1. Takes test datasets as input
#   2. Compares different normalization methods
#   3. Generates plots for comparison
# ==============================================================================

#################################
##### Packages and Setup ########
#################################

rm(list = ls())
suppressPackageStartupMessages({
    library(DESeq2)
    library(edgeR)
    library(limma)
    library(tibble)
    library(dplyr)
    library(ggplot2)
    library(data.table)
    library(purrr)
    library(glue)
    library(stringr)
})

source("src/utils/utils_io.R")
# -----  Extract Key Settings from config.yaml -----
library(yaml)  # to read the YAML config
config <- yaml::read_yaml("config/config.yaml")

test_data_dir <- config$project_dirs$test_data_dir
create_directories(c(test_data_dir))

#####################
##### Datasets ######
#####################

# Test files (smaller subsets)
test_vst_ct_file <- file.path(test_data_dir, "VSTdataN_test.txt")
test_vst_hs_file <- file.path(test_data_dir, "VSTdataHS_test.txt")
test_voom_ct_file <- file.path(test_data_dir, "voomdataN_test.txt")
test_voom_hs_file <- file.path(test_data_dir, "voomdataHS_test.txt")

# Read in test datasets
vst_ct <- fread(test_vst_ct_file, data.table = F)
vst_hs <- fread(test_vst_hs_file, data.table = F)
voom_ct <- fread(test_voom_ct_file, data.table = F)
voom_hs <- fread(test_voom_hs_file, data.table = F)

# Set rownames
vst_ct <- column_to_rownames(vst_ct, "V1")
vst_hs <- column_to_rownames(vst_hs, "V1")
voom_ct <- column_to_rownames(voom_ct, "V1")
voom_hs <- column_to_rownames(voom_hs, "V1")